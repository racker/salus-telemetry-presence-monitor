steps:
  - name: 'gcr.io/cloud-builders/gsutil'
    id: GET_SETTINGS
    args: ['cp', 'gs://salus-mavenrepository/m2-settings.xml', '.mvn/settings.xml']
  - name: 'gcr.io/cloud-builders/mvn'
    id: DEPLOY
    args: ['deploy', '-s', '.mvn/settings.xml']
  - name: 'gcr.io/cloud-builders/mvn'
    id: COMPILE N DEPLOY
    args: ['compile','jib:dockerBuild', '-Dmaven.test.skip=true', '-Ddocker.image.prefix=gcr.io/$PROJECT_ID', '-s', '.mvn/settings.xml']

images:
  - 'gcr.io/$PROJECT_ID/salus-telemetry-presence-monitor'

